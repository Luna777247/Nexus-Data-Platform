# Redis Configuration for Nexus Data Platform
# Version: 7.2

# ========================================
# NETWORK
# ========================================
bind 0.0.0.0
protected-mode no
port 6379
tcp-backlog 511
timeout 300
tcp-keepalive 300

# ========================================
# GENERAL
# ========================================
daemonize no
supervised no
pidfile /var/run/redis.pid
loglevel notice
logfile ""
databases 16

# ========================================
# SNAPSHOTTING (RDB)
# ========================================
# Save the DB on disk:
# save <seconds> <changes>
save 900 1       # After 900 sec (15 min) if at least 1 key changed
save 300 10      # After 300 sec (5 min) if at least 10 keys changed
save 60 1000     # After 60 sec if at least 1000 keys changed

stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# ========================================
# REPLICATION
# ========================================
# For master-replica setup:
# replicaof <masterip> <masterport>
# replica-read-only yes
# replica-serve-stale-data yes

# ========================================
# SECURITY
# ========================================
# For production, set a password:
# requirepass your-strong-password-here

# ========================================
# MEMORY MANAGEMENT
# ========================================
maxmemory 1gb
maxmemory-policy allkeys-lru

# LRU/LFU tuning
# maxmemory-samples 5
# lfu-log-factor 10
# lfu-decay-time 1

# ========================================
# LAZY FREEING
# ========================================
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no

# ========================================
# APPEND ONLY FILE (AOF)
# ========================================
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec

no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes

# ========================================
# LUA SCRIPTING
# ========================================
lua-time-limit 5000

# ========================================
# SLOW LOG
# ========================================
slowlog-log-slower-than 10000
slowlog-max-len 128

# ========================================
# LATENCY MONITORING
# ========================================
latency-monitor-threshold 0

# ========================================
# EVENT NOTIFICATION
# ========================================
notify-keyspace-events ""

# ========================================
# ADVANCED CONFIG
# ========================================
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100

# Active rehashing
activerehashing yes

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# ========================================
# THREADS
# ========================================
# io-threads 4
# io-threads-do-reads no

# ========================================
# KERNEL TUNING
# ========================================
# Linux overcommit from /proc/sys/vm/overcommit_memory
# 0 = kernel will estimate
# 1 = always overcommit
# 2 = never overcommit (not recommended)
